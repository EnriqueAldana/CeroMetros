{"code":"module.exportDefault = function(value) { __vue_script__ = value; }; (function(){var Message;\nmodule.link(\"../../../api/Messages/Message\", {\n  Message: function (v) {\n    Message = v;\n  }\n}, 0);\nvar date;\nmodule.link(\"../../mixins/helpers/date\", {\n  \"default\": function (v) {\n    date = v;\n  }\n}, 1);\nmodule.exportDefault({\n  name: 'Chat',\n  mixins: [date],\n  data: function () {\n    return {\n      contactSelected: null,\n      message: {\n        idSender: null,\n        idReceiver: null,\n        date: null,\n        text: null,\n        read: false\n      }\n    };\n  },\n  updated: function () {\n    var elem = this.$el.querySelector('#msgContainer');\n\n    if (elem) {\n      elem.scrollTop = elem.scrollHeight;\n    }\n  },\n  methods: {\n    sendMessage: function () {\n      var _this = this;\n\n      this.message.idSender = Meteor.userId();\n      this.message.idReceiver = this.contactSelected._id;\n      this.message.date = this.currentLocalDate().toISOString();\n      Meteor.call('message.save', this.message, function (error, response) {\n        if (error) {\n          _this.$alert.showAlertSimple('error', error.reason);\n        } else {\n          _this.message.text = null;\n        }\n      });\n    },\n    markMessageAsRead: function () {\n      var _this2 = this;\n\n      var unReadMessages = [];\n      unReadMessages = this.messages.filter(function (message) {\n        return message.read === false && message.idReceiver === Meteor.userId();\n      });\n\n      if (unReadMessages.length) {\n        Meteor.call('messages.read', unReadMessages, function (error) {\n          if (error) {\n            _this2.$alert.showAlertSimple('error', error.reason);\n          }\n        });\n      }\n    }\n  },\n  meteor: {\n    $subscribe: {\n      'user.list': [],\n      'message.list': function () {\n        return [this.contactSelected ? this.contactSelected._id : null];\n      }\n    },\n    users: function () {\n      return Meteor.users.find({\n        _id: {\n          $ne: Meteor.userId()\n        }\n      }).fetch();\n    },\n    messages: function () {\n      return this.contactSelected ? Message.find({}, {\n        sort: {\n          date: 1\n        }\n      }).fetch() : [];\n    }\n  }\n});\n})();","map":{"version":3,"sources":["imports/ui/views/Chat/Chat.vue"],"names":["Message","module","link","v","date","exportDefault","name","mixins","data","contactSelected","message","idSender","idReceiver","text","read","updated","elem","$el","querySelector","scrollTop","scrollHeight","methods","sendMessage","Meteor","userId","_id","currentLocalDate","toISOString","call","error","response","$alert","showAlertSimple","reason","markMessageAsRead","unReadMessages","messages","filter","length","meteor","$subscribe","users","find","$ne","fetch","sort"],"mappings":";;;;;;;;;;;;qBA+EA;AACA,EAAA,IAAA,EAAA,MADA;AAEA,EAAA,MAAA,EAAA,CAAA,IAAA,CAFA;AAGA,EAAA,IAHA,cAGA;AACA,WAAA;AACA,MAAA,eAAA,EAAA,IADA;AAEA,MAAA,OAAA,EAAA;AACA,QAAA,QAAA,EAAA,IADA;AAEA,QAAA,UAAA,EAAA,IAFA;AAGA,QAAA,IAAA,EAAA,IAHA;AAIA,QAAA,IAAA,EAAA,IAJA;AAKA,QAAA,IAAA,EAAA;AALA;AAFA,KAAA;AAUA,GAdA;AAeA,EAAA,OAfA,cAeA;AACA,QAAA,IAAA,GAAA,KAAA,GAAA,CAAA,aAAA,CAAA,eAAA,CAAA;;AACA,QAAA,IAAA,EAAA;AACA,MAAA,IAAA,CAAA,SAAA,GAAA,IAAA,CAAA,YAAA;AACA;AACA,GApBA;AAqBA,EAAA,OAAA,EAAA;AACA,IAAA,WADA,cACA;AAAA;;AACA,WAAA,OAAA,CAAA,QAAA,GAAA,MAAA,CAAA,MAAA,EAAA;AACA,WAAA,OAAA,CAAA,UAAA,GAAA,KAAA,eAAA,CAAA,GAAA;AACA,WAAA,OAAA,CAAA,IAAA,GAAA,KAAA,gBAAA,GAAA,WAAA,EAAA;AACA,MAAA,MAAA,CAAA,IAAA,CAAA,cAAA,EAAA,KAAA,OAAA,EAAA,UAAA,KAAA,EAAA,QAAA,EAAA;AACA,YAAA,KAAA,EAAA;AACA,UAAA,KAAA,CAAA,MAAA,CAAA,eAAA,CAAA,OAAA,EAAA,KAAA,CAAA,MAAA;AACA,SAFA,MAEA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,IAAA,GAAA,IAAA;AACA;AAEA,OAPA;AAUA,KAfA;AAgBA,IAAA,iBAhBA,cAgBA;AAAA;;AACA,UAAA,cAAA,GAAA,EAAA;AACA,MAAA,cAAA,GAAA,KAAA,QAAA,CAAA,MAAA,CAAA,UAAA,OAAA;AAAA,eAAA,OAAA,CAAA,IAAA,KAAA,KAAA,IAAA,OAAA,CAAA,UAAA,KAAA,MAAA,CAAA,MAAA,EAAA;AAAA,OAAA,CAAA;;AACA,UAAA,cAAA,CAAA,MAAA,EAAA;AACA,QAAA,MAAA,CAAA,IAAA,CAAA,eAAA,EAAA,cAAA,EAAA,UAAA,KAAA,EAAA;AACA,cAAA,KAAA,EAAA;AACA,YAAA,MAAA,CAAA,MAAA,CAAA,eAAA,CAAA,OAAA,EAAA,KAAA,CAAA,MAAA;AACA;AAEA,SALA;AAMA;AACA;AA3BA,GArBA;AAkDA,EAAA,MAAA,EAAA;AACA,IAAA,UAAA,EAAA;AACA,mBAAA,EADA;AAEA,sBAAA,YAAA;AACA,eAAA,CAAA,KAAA,eAAA,GAAA,KAAA,eAAA,CAAA,GAAA,GAAA,IAAA,CAAA;AACA;AAJA,KADA;AAOA,IAAA,KAPA,cAOA;AACA,aAAA,MAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AAAA,QAAA,GAAA,EAAA;AAAA,UAAA,GAAA,EAAA,MAAA,CAAA,MAAA;AAAA;AAAA,OAAA,EAAA,KAAA,EAAA;AACA,KATA;AAUA,IAAA,QAVA,cAUA;AACA,aAAA,KAAA,eAAA,GAAA,OAAA,CAAA,IAAA,CAAA,EAAA,EAAA;AACA,QAAA,IAAA,EAAA;AACA,UAAA,IAAA,EAAA;AADA;AADA,OAAA,EAIA,KAJA,EAAA,GAIA,EAJA;AAKA;AAhBA;AAlDA","sourcesContent":["<template>\n   <v-container fluid>\n        <v-row>\n            <v-col cols=\"12\" xs=\"12\" sm=\"4\" md=\"3\" lg=\"2\" xl=\"2\">\n                <v-card class=\"mx-auto\" max-width=\"300\" tile>\n                    <v-list subheader>\n                       <v-subheader>Contactos</v-subheader>\n                        <v-list-item-group v-model=\"contactSelected\" color=\"primary\">\n                            <v-divider></v-divider>\n                                <template v-for=\"contact in users\">\n                                    <v-list-item :key=\"contact._id\" :value=\"contact\">\n                                      <v-list-item-icon>\n                                            <v-icon :color=\"contact.status.online?'green':'red'\">\n                                                mdi-checkbox-blank-circle\n                                            </v-icon>\n                                        </v-list-item-icon>\n                                        <v-list-item-content>\n                                            <v-list-item-title v-text=\"contact.profile.name\">\n                                            </v-list-item-title>\n                                        </v-list-item-content>  \n                                    </v-list-item>\n                                </template>\n                        </v-list-item-group> \n                    </v-list>\n                </v-card>\n            </v-col>\n            <v-col cols=\"12\" xs=\"12\" sm=\"8\" md=\"9\" lg=\"10\" xl=\"10\">\n                <v-card class=\"mx-auto\" v-if=\"contactSelected\" height=\"70vh\">\n                    <v-list-item>\n                        <v-list-item-avatar size=\"36px\">\n                            <img :src=\"contactSelected.profile.path || '/img/user.png'\" alt=\"Avatar\">\n                        </v-list-item-avatar>\n                        <v-list-item-title class=\"headline\">{{contactSelected.profile.name}}</v-list-item-title>\n                    </v-list-item>\n                    <v-card-text id=\"msgContainer\" style=\"height: 70%\" class=\"overflow-y-auto\">\n                        <v-row v-for=\"msg in messages\" :class=\"msg.idReceiver===contactSelected._id?'justify-end':'justify-start'\">\n                            <v-col cols=\"7\">\n                                <v-card raised shaped :color=\"msg.idReceiver===contactSelected._id? 'cyan lighten-5':'red lighten-5'\">\n                                    <v-card-text class=\"pb-1\">\n                                    {{msg.text}}\n                                    </v-card-text>\n                                    <v-card-subtitle class=\"text-right pt-1 pb-1\">\n                                        <v-tooltip left>\n                                            <template v-slot:activator=\"{on}\">\n                                                <v-icon v-on=\"on\" small>info_outlined</v-icon>\n                                            </template>\n                                            <span>{{ msg.date.substring(0,10)}}</span>\n                                        </v-tooltip>\n                                        {{ msg.date.split('T')[1].substring(0,5) }}\n                                        <v-icon style=\"margin-right: -15px\" small :color=\"msg.read?'blue':'gray'\">\n                                            check\n                                        </v-icon>\n                                        <v-icon small :color=\"msg.read?'blue':'gray'\">\n                                            check\n                                        </v-icon>\n                                    </v-card-subtitle>\n                                </v-card>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                    <v-card-actions>\n                        <v-text-field autocomplete=\"off\" v-model=\"message.text\" v-on:keyup.enter=\"sendMessage\" @focus=\"markMessageAsRead\" label=\"Introduce tu mensaje\">\n                        </v-text-field>\n                        <v-btn class=\"mx-2\" @click=\"sendMessage\" fab dark color=\"indigo\">\n                            <v-icon dark>send</v-icon>\n                        </v-btn>\n                    </v-card-actions>\n                </v-card>\n                <v-card v-else height=\"70vh\">\n                <h1>Bienvenido al Chat</h1>\n                </v-card>\n            </v-col>\n        </v-row>\n   </v-container>\n</template>\n\n<script>\nimport { Message } from '../../../api/Messages/Message';\nimport date from'../../mixins/helpers/date';\nexport default {\nname: 'Chat',\nmixins: [date],\ndata() {\n    return {\n        contactSelected: null,\n        message: {\n            idSender: null,\n            idReceiver: null,\n            date: null,\n            text: null,\n            read: false\n        }\n    };\n},\nupdated() {\n    const elem= this.$el.querySelector('#msgContainer');\n    if(elem){\n        elem.scrollTop= elem.scrollHeight;\n    }\n},\nmethods: {\n    sendMessage() {\n    this.message.idSender= Meteor.userId();\n    this.message.idReceiver= this.contactSelected._id;\n    this.message.date= this.currentLocalDate().toISOString();\n    Meteor.call('message.save',this.message,(error,response) =>{\n        if(error){\n            this.$alert.showAlertSimple('error',error.reason);\n        }else{\n            this.message.text=null;\n        }\n    \n    });\n\n\n    },\n    markMessageAsRead() {\n        let unReadMessages = [];\n        unReadMessages = this.messages.filter(message => message.read === false && message.idReceiver === Meteor.userId());\n        if(unReadMessages.length){\n            Meteor.call('messages.read',unReadMessages,(error) =>{\n                if(error){\n                    this.$alert.showAlertSimple('error',error.reason);\n                }\n    \n            });\n        }\n    }\n},\n  meteor:{\n    $subscribe: {\n      'user.list':[],\n      'message.list': function(){\n          return [this.contactSelected ? this.contactSelected._id : null];\n      }\n    },\n    users(){\n      return Meteor.users.find({_id:{$ne:Meteor.userId()}}).fetch();\n    },\n    messages() {\n        return this.contactSelected ? Message.find({},{\n          sort: {\n            date:1\n          }\n        }).fetch(): [];\n    }\n  }\n};\n</script>\n\n<style scoped>\n\n</style>"],"file":"imports/ui/views/Chat/Chat.vue"},"styles":[{"css":"\n\n","map":{"version":3,"sources":[],"names":[],"mappings":"","file":"Chat.vue"}}],"template":"\n<v-container fluid>\n     <v-row>\n         <v-col cols=\"12\" xs=\"12\" sm=\"4\" md=\"3\" lg=\"2\" xl=\"2\">\n             <v-card class=\"mx-auto\" max-width=\"300\" tile>\n                 <v-list subheader>\n                    <v-subheader>Contactos</v-subheader>\n                     <v-list-item-group v-model=\"contactSelected\" color=\"primary\">\n                         <v-divider></v-divider>\n                             <template v-for=\"contact in users\">\n                                 <v-list-item :key=\"contact._id\" :value=\"contact\">\n                                   <v-list-item-icon>\n                                         <v-icon :color=\"contact.status.online?'green':'red'\">\n                                             mdi-checkbox-blank-circle\n                                         </v-icon>\n                                     </v-list-item-icon>\n                                     <v-list-item-content>\n                                         <v-list-item-title v-text=\"contact.profile.name\">\n                                         </v-list-item-title>\n                                     </v-list-item-content>  \n                                 </v-list-item>\n                             </template>\n                     </v-list-item-group> \n                 </v-list>\n             </v-card>\n         </v-col>\n         <v-col cols=\"12\" xs=\"12\" sm=\"8\" md=\"9\" lg=\"10\" xl=\"10\">\n             <v-card class=\"mx-auto\" v-if=\"contactSelected\" height=\"70vh\">\n                 <v-list-item>\n                     <v-list-item-avatar size=\"36px\">\n                         <img :src=\"contactSelected.profile.path || '/img/user.png'\" alt=\"Avatar\">\n                     </v-list-item-avatar>\n                     <v-list-item-title class=\"headline\">{{contactSelected.profile.name}}</v-list-item-title>\n                 </v-list-item>\n                 <v-card-text id=\"msgContainer\" style=\"height: 70%\" class=\"overflow-y-auto\">\n                     <v-row v-for=\"msg in messages\" :class=\"msg.idReceiver===contactSelected._id?'justify-end':'justify-start'\">\n                         <v-col cols=\"7\">\n                             <v-card raised shaped :color=\"msg.idReceiver===contactSelected._id? 'cyan lighten-5':'red lighten-5'\">\n                                 <v-card-text class=\"pb-1\">\n                                 {{msg.text}}\n                                 </v-card-text>\n                                 <v-card-subtitle class=\"text-right pt-1 pb-1\">\n                                     <v-tooltip left>\n                                         <template v-slot:activator=\"{on}\">\n                                             <v-icon v-on=\"on\" small>info_outlined</v-icon>\n                                         </template>\n                                         <span>{{ msg.date.substring(0,10)}}</span>\n                                     </v-tooltip>\n                                     {{ msg.date.split('T')[1].substring(0,5) }}\n                                     <v-icon style=\"margin-right: -15px\" small :color=\"msg.read?'blue':'gray'\">\n                                         check\n                                     </v-icon>\n                                     <v-icon small :color=\"msg.read?'blue':'gray'\">\n                                         check\n                                     </v-icon>\n                                 </v-card-subtitle>\n                             </v-card>\n                         </v-col>\n                     </v-row>\n                 </v-card-text>\n                 <v-card-actions>\n                     <v-text-field autocomplete=\"off\" v-model=\"message.text\" v-on:keyup.enter=\"sendMessage\" @focus=\"markMessageAsRead\" label=\"Introduce tu mensaje\">\n                     </v-text-field>\n                     <v-btn class=\"mx-2\" @click=\"sendMessage\" fab dark color=\"indigo\">\n                         <v-icon dark>send</v-icon>\n                     </v-btn>\n                 </v-card-actions>\n             </v-card>\n             <v-card v-else height=\"70vh\">\n             <h1>Bienvenido al Chat</h1>\n             </v-card>\n         </v-col>\n     </v-row>\n</v-container>\n","hash":"data-v-2dc1bbe5"}