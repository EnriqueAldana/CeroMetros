{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/middlewares/PermissionMiddleware.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/middlewares/PermissionMiddleware.js","filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/middlewares/PermissionMiddleware.js","cloneInputAst":true,"passPerPreset":false,"envName":"development","cwd":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","root":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.12.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/middlewares/PermissionMiddleware.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/middlewares/PermissionMiddleware.js"}},"code":"module.export({\n  PermissionMiddleware: () => PermissionMiddleware\n});\n\nclass PermissionMiddleware extends PublishMiddleware {\n  constructor(permissions) {\n    super();\n    this._permissions = permissions;\n  } // solo a este evento no le verificamos permisos para no sobre cargar el proceso\n  // ya que en una lista por cada elemento agregado es llamada esta funcion\n\n\n  added(publish, collection, id, fields) {\n    if (publish.userId) {\n      return super.added(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  changed(publish, collection, id, fields) {\n    if (this.checkPermission(publish.userId)) {\n      return super.changed(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  removed(publish, collection, id) {\n    if (this.checkPermission(publish.userId)) {\n      return super.removed(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  onReady(publish) {\n    if (publish.userId) {\n      return super.onReady(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  onStop(publish) {\n    if (publish.userId) {\n      return super.onStop(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  onError(publish, error) {\n    if (publish.userId) {\n      return super.onError(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  checkPermission(idUser) {\n    const profileName = Roles.getScopesForUser(idUser)[0];\n    return Roles.userIsInRole(idUser, this._permissions, profileName);\n  }\n\n}","map":{"version":3,"sources":["imports/middlewares/PermissionMiddleware.js"],"names":["module","export","PermissionMiddleware","PublishMiddleware","constructor","permissions","_permissions","added","publish","collection","id","fields","userId","arguments","ready","changed","checkPermission","removed","onReady","onStop","onError","error","idUser","profileName","Roles","getScopesForUser","userIsInRole"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,oBAAoB,EAAC,MAAIA;AAA1B,CAAd;;AAAO,MAAMA,oBAAN,SAAmCC,iBAAnC,CAAqD;AAEpDC,EAAAA,WAAW,CAACC,WAAD,EAAa;AACpB;AACA,SAAKC,YAAL,GAAoBD,WAApB;AACH,GALmD,CAOpD;AACA;;;AACAE,EAAAA,KAAK,CAACC,OAAD,EAASC,UAAT,EAAoBC,EAApB,EAAuBC,MAAvB,EAA8B;AAC/B,QAAGH,OAAO,CAACI,MAAX,EAAkB;AACd,aAAO,MAAML,KAAN,CAAY,GAAGM,SAAf,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AACH;;AAEDC,EAAAA,OAAO,CAACP,OAAD,EAASC,UAAT,EAAoBC,EAApB,EAAuBC,MAAvB,EAA8B;AACjC,QAAI,KAAKK,eAAL,CAAqBR,OAAO,CAACI,MAA7B,CAAJ,EAAyC;AACvC,aAAO,MAAMG,OAAN,CAAc,GAAGF,SAAjB,CAAP;AACD;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AAEH;;AAEDG,EAAAA,OAAO,CAACT,OAAD,EAASC,UAAT,EAAoBC,EAApB,EAAuB;AAC1B,QAAI,KAAKM,eAAL,CAAqBR,OAAO,CAACI,MAA7B,CAAJ,EAAyC;AACrC,aAAO,MAAMK,OAAN,CAAc,GAAGJ,SAAjB,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AAEH;;AAEDI,EAAAA,OAAO,CAACV,OAAD,EAAS;AACZ,QAAIA,OAAO,CAACI,MAAZ,EAAmB;AACf,aAAO,MAAMM,OAAN,CAAc,GAAGL,SAAjB,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AAEH;;AACDK,EAAAA,MAAM,CAACX,OAAD,EAAS;AACX,QAAIA,OAAO,CAACI,MAAZ,EAAmB;AACf,aAAO,MAAMO,MAAN,CAAa,GAAGN,SAAhB,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AAEH;;AAEDM,EAAAA,OAAO,CAACZ,OAAD,EAASa,KAAT,EAAe;AAClB,QAAIb,OAAO,CAACI,MAAZ,EAAmB;AACf,aAAO,MAAMQ,OAAN,CAAc,GAAGP,SAAjB,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AAEH;;AAGDE,EAAAA,eAAe,CAACM,MAAD,EAAQ;AACnB,UAAMC,WAAW,GAACC,KAAK,CAACC,gBAAN,CAAuBH,MAAvB,EAA+B,CAA/B,CAAlB;AACA,WAAOE,KAAK,CAACE,YAAN,CAAmBJ,MAAnB,EAA2B,KAAKhB,YAAhC,EAA8CiB,WAA9C,CAAP;AACH;;AA3DmD","sourcesContent":["export class PermissionMiddleware extends PublishMiddleware {\n\n        constructor(permissions){\n            super();\n            this._permissions = permissions;\n        }\n\n        // solo a este evento no le verificamos permisos para no sobre cargar el proceso\n        // ya que en una lista por cada elemento agregado es llamada esta funcion\n        added(publish,collection,id,fields){\n            if(publish.userId){\n                return super.added(...arguments);\n            }\n            return publish.ready();\n        }\n\n        changed(publish,collection,id,fields){\n            if (this.checkPermission(publish.userId)){\n              return super.changed(...arguments);\n            }\n            return publish.ready();\n\n        }\n\n        removed(publish,collection,id){\n            if (this.checkPermission(publish.userId)){\n                return super.removed(...arguments);\n            }\n            return publish.ready();\n\n        }\n\n        onReady(publish){\n            if (publish.userId){\n                return super.onReady(...arguments);\n            }\n            return publish.ready();\n\n        }\n        onStop(publish){\n            if (publish.userId){\n                return super.onStop(...arguments);\n            }\n            return publish.ready();\n\n        }\n\n        onError(publish,error){\n            if (publish.userId){\n                return super.onError(...arguments);\n            }\n            return publish.ready();\n\n        }\n\n\n        checkPermission(idUser){\n            const profileName=Roles.getScopesForUser(idUser)[0];\n            return Roles.userIsInRole(idUser, this._permissions, profileName);\n        }\n\n}"]},"sourceType":"module","hash":"02885a7909de1e0c88cf2a601d8e51eff7ce88b2"}
