{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/api/Profiles/ProfilesServ.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/api/Profiles/ProfilesServ.js","filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/api/Profiles/ProfilesServ.js","cloneInputAst":true,"passPerPreset":false,"envName":"development","cwd":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","root":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.12.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/api/Profiles/ProfilesServ.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/Profiles/ProfilesServ.js"}},"code":"let Profile;\nmodule.link(\"./Profile\", {\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet StaticProfiles;\nmodule.link(\"./ProfileSeeder\", {\n  StaticProfiles(v) {\n    StaticProfiles = v;\n  }\n\n}, 2);\nmodule.exportDefault({\n  getUsersByprofile(idPrtofile) {\n    const profile = Profile.findOne(idPrtofile);\n    return Meteor.users.find({\n      'profile.profile': profile.name\n    }).fetch();\n  },\n\n  setUsersRoles(idUser, profileName) {\n    const permissions = Profile.findOne({\n      'name': profileName\n    }).permissions;\n    Meteor.roleAssignment.remove({\n      'user._id': idUser\n    });\n    Roles.setUserRoles(idUser, permissions, profileName);\n  },\n\n  updateProfileUsers(users, profile) {\n    users.forEach(user => {\n      this.setUsersRoles(user._id, profile.name);\n    });\n  },\n\n  validateProfileName(newProfileName, idProfile) {\n    const query = {\n      name: newProfileName\n    };\n    const existsProfileName = Profile.findOne(query);\n\n    if (idProfile) {\n      // actualizacion de usuario//\n      const oldProfile = Profile.findOne(idProfile);\n\n      if (oldProfile.name !== newProfileName && existsProfileName) {\n        throw new Meteor.Error('403', 'El nombre del Perfil  ya esta siendo utilizado');\n      }\n    } else if (existsProfileName) {\n      // El nombre de NUEVO profile ya existe\n      throw new Meteor.Error('403', 'El nombre del Perfil  ya esta siendo utilizado');\n    }\n  },\n\n  getStaticprofilesName() {\n    return Object.keys(StaticProfiles).map(staticprofileName => {\n      return StaticProfiles[staticprofileName].name;\n    });\n  }\n\n});","map":{"version":3,"sources":["imports/api/Profiles/ProfilesServ.js"],"names":["Profile","module","link","v","Meteor","StaticProfiles","exportDefault","getUsersByprofile","idPrtofile","profile","findOne","users","find","name","fetch","setUsersRoles","idUser","profileName","permissions","roleAssignment","remove","Roles","setUserRoles","updateProfileUsers","forEach","user","_id","validateProfileName","newProfileName","idProfile","query","existsProfileName","oldProfile","Error","getStaticprofilesName","Object","keys","map","staticprofileName"],"mappings":"AAAA,IAAIA,OAAJ;AAAYC,MAAM,CAACC,IAAP,CAAY,WAAZ,EAAwB;AAACF,EAAAA,OAAO,CAACG,CAAD,EAAG;AAACH,IAAAA,OAAO,GAACG,CAAR;AAAU;;AAAtB,CAAxB,EAAgD,CAAhD;AAAmD,IAAIC,MAAJ;AAAWH,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACE,EAAAA,MAAM,CAACD,CAAD,EAAG;AAACC,IAAAA,MAAM,GAACD,CAAP;AAAS;;AAApB,CAA5B,EAAkD,CAAlD;AAAqD,IAAIE,cAAJ;AAAmBJ,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAACG,EAAAA,cAAc,CAACF,CAAD,EAAG;AAACE,IAAAA,cAAc,GAACF,CAAf;AAAiB;;AAApC,CAA9B,EAAoE,CAApE;AAAlJF,MAAM,CAACK,aAAP,CAIe;AAEXC,EAAAA,iBAAiB,CAACC,UAAD,EAAY;AACrB,UAAMC,OAAO,GAAGT,OAAO,CAACU,OAAR,CAAgBF,UAAhB,CAAhB;AACA,WAAOJ,MAAM,CAACO,KAAP,CAAaC,IAAb,CAAkB;AAAC,yBAAkBH,OAAO,CAACI;AAA3B,KAAlB,EAAoDC,KAApD,EAAP;AACH,GALM;;AAMXC,EAAAA,aAAa,CAACC,MAAD,EAASC,WAAT,EAAqB;AAC9B,UAAMC,WAAW,GAAElB,OAAO,CAACU,OAAR,CAAgB;AAAC,cAAOO;AAAR,KAAhB,EAAsCC,WAAzD;AACCd,IAAAA,MAAM,CAACe,cAAP,CAAsBC,MAAtB,CAA6B;AAAC,kBAAYJ;AAAb,KAA7B;AACAK,IAAAA,KAAK,CAACC,YAAN,CAAmBN,MAAnB,EAA0BE,WAA1B,EAAsCD,WAAtC;AACA,GAVM;;AAWXM,EAAAA,kBAAkB,CAACZ,KAAD,EAAOF,OAAP,EAAe;AAC/BE,IAAAA,KAAK,CAACa,OAAN,CAAcC,IAAI,IAAI;AACZ,WAAKV,aAAL,CAAmBU,IAAI,CAACC,GAAxB,EAA4BjB,OAAO,CAACI,IAApC;AACJ,KAFN;AAGD,GAfU;;AAeTc,EAAAA,mBAAmB,CAACC,cAAD,EAAgBC,SAAhB,EAA0B;AAC3C,UAAMC,KAAK,GAAG;AAAEjB,MAAAA,IAAI,EAAEe;AAAR,KAAd;AACA,UAAMG,iBAAiB,GAAE/B,OAAO,CAACU,OAAR,CAAgBoB,KAAhB,CAAzB;;AACA,QAAID,SAAJ,EAAc;AAAE;AACZ,YAAMG,UAAU,GAAEhC,OAAO,CAACU,OAAR,CAAgBmB,SAAhB,CAAlB;;AACA,UAAGG,UAAU,CAACnB,IAAX,KAAoBe,cAApB,IAAsCG,iBAAzC,EAA2D;AACvD,cAAM,IAAI3B,MAAM,CAAC6B,KAAX,CAAiB,KAAjB,EAAwB,gDAAxB,CAAN;AACH;AAEJ,KAND,MAMM,IAAGF,iBAAH,EAAqB;AAAE;AACzB,YAAM,IAAI3B,MAAM,CAAC6B,KAAX,CAAiB,KAAjB,EAAwB,gDAAxB,CAAN;AACH;AACJ,GA3BU;;AA4BXC,EAAAA,qBAAqB,GAAE;AAEnB,WAAOC,MAAM,CAACC,IAAP,CAAY/B,cAAZ,EAA4BgC,GAA5B,CAAgCC,iBAAiB,IAAI;AACxD,aAAOjC,cAAc,CAACiC,iBAAD,CAAd,CAAkCzB,IAAzC;AACH,KAFM,CAAP;AAGH;;AAjCU,CAJf","sourcesContent":["import {Profile} from './Profile';\nimport {Meteor} from 'meteor/meteor'\nimport {StaticProfiles} from \"./ProfileSeeder\";\n\nexport default {\n\n    getUsersByprofile(idPrtofile){\n            const profile = Profile.findOne(idPrtofile);\n            return Meteor.users.find({'profile.profile':profile.name}).fetch();\n        },\n    setUsersRoles(idUser, profileName){\n        const permissions= Profile.findOne({'name':profileName}).permissions;\n         Meteor.roleAssignment.remove({'user._id': idUser});\n         Roles.setUserRoles(idUser,permissions,profileName);\n        },\n    updateProfileUsers(users,profile){\n      users.forEach(user => {\n                this.setUsersRoles(user._id,profile.name);\n           });\n    },validateProfileName(newProfileName,idProfile){\n        const query = { name: newProfileName };\n        const existsProfileName= Profile.findOne(query);\n        if (idProfile){ // actualizacion de usuario//\n            const oldProfile= Profile.findOne(idProfile);\n            if(oldProfile.name !== newProfileName && existsProfileName){\n                throw new Meteor.Error('403', 'El nombre del Perfil  ya esta siendo utilizado');\n            }\n\n        }else if(existsProfileName){ // El nombre de NUEVO profile ya existe\n            throw new Meteor.Error('403', 'El nombre del Perfil  ya esta siendo utilizado');\n        }\n    },\n    getStaticprofilesName(){\n\n        return Object.keys(StaticProfiles).map(staticprofileName => {\n            return StaticProfiles[staticprofileName].name;\n        });\n    }\n\n\n}"]},"sourceType":"module","hash":"fda564aca4d6f16c71ba00354f26b13fdec845bf"}
