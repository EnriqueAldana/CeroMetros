{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/startup/server/utilities/FileOperations.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/startup/server/utilities/FileOperations.js","filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/startup/server/utilities/FileOperations.js","cloneInputAst":true,"passPerPreset":false,"envName":"development","cwd":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","root":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.12.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/startup/server/utilities/FileOperations.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/startup/server/utilities/FileOperations.js"}},"code":"let mimetypes;\nmodule.link(\"mimetypes\", {\n  default(v) {\n    mimetypes = v;\n  }\n\n}, 0);\nlet Utilities;\nmodule.link(\"./Utilities\", {\n  default(v) {\n    Utilities = v;\n  }\n\n}, 1);\nlet BASE_URL_STORAGE, firebaseAdminsStorage;\nmodule.link(\"../services/FirebaseAdmin\", {\n  BASE_URL_STORAGE(v) {\n    BASE_URL_STORAGE = v;\n  },\n\n  firebaseAdminsStorage(v) {\n    firebaseAdminsStorage = v;\n  }\n\n}, 2);\nlet ResponseMessage;\nmodule.link(\"./ResponseMesssage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 3);\nmodule.exportDefault({\n  saveFileFromBufferToGoogleStorage(fileBuffer, name, path, mimeType) {\n    return Promise.asyncApply(() => {\n      const responseMessage = new ResponseMessage();\n      const versionFile = Utilities.generateNumberToken(10, 99);\n      const filename = \"\".concat(name).concat(versionFile, \".\").concat(mimetypes.detectExtension(mimeType));\n      const file = firebaseAdminsStorage.file(\"\".concat(path, \"/\").concat(filename));\n      const fileUrl = \"\".concat(BASE_URL_STORAGE, \"/\").concat(firebaseAdminsStorage.name, \"/\").concat(path, \"/\").concat(filename);\n\n      try {\n        Promise.await(file.save(fileBuffer, {\n          metadata: {\n            contentType: mimeType\n          },\n          public: true\n        }));\n        responseMessage.create('File uploaded', null, {\n          success: true,\n          fileUrl\n        });\n      } catch (exception) {\n        console.error('Error uploading file to Google Storage: ', exception);\n        responseMessage.create('Error uploading file to Google Storage', null, {\n          success: false\n        });\n      }\n\n      return responseMessage;\n    });\n  },\n\n  saveFileFromBase64ToGoogleStorage(base64file, name, path) {\n    return Promise.asyncApply(() => {\n      const mimeType = base64file.match(/data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+).*,.*/)[1];\n      const base64EncodedImageString = base64file.split(';base64,').pop();\n      const fileBuffer = Buffer.from(base64EncodedImageString, 'base64');\n      return Promise.await(this.saveFileFromBufferToGoogleStorage(fileBuffer, name, path, mimeType));\n    });\n  },\n\n  deleteFileFromGoogleStoreIfExists(fileLocation) {\n    return Promise.asyncApply(() => {\n      const file = firebaseAdminsStorage.file(fileLocation);\n\n      try {\n        const existsFile = Promise.await(file.exists());\n\n        if (existsFile[0]) {\n          Promise.await(file.delete());\n        }\n      } catch (exception) {\n        console.error('Ha habido un error al borrar archivo de Google Store', exception);\n      }\n    });\n  },\n\n  deleteFilesOfFolderFromGoogleStorage(userFolder) {\n    return Promise.asyncApply(() => {\n      try {\n        Promise.await(firebaseAdminsStorage.deleteFiles({\n          prefix: userFolder + '/'\n        }));\n      } catch (exception) {\n        console.error('Error deleting files from Google Storage');\n      }\n    });\n  }\n\n});","map":{"version":3,"sources":["imports/startup/server/utilities/FileOperations.js"],"names":["mimetypes","module","link","default","v","Utilities","BASE_URL_STORAGE","firebaseAdminsStorage","ResponseMessage","exportDefault","saveFileFromBufferToGoogleStorage","fileBuffer","name","path","mimeType","responseMessage","versionFile","generateNumberToken","filename","detectExtension","file","fileUrl","save","metadata","contentType","public","create","success","exception","console","error","saveFileFromBase64ToGoogleStorage","base64file","match","base64EncodedImageString","split","pop","Buffer","from","deleteFileFromGoogleStoreIfExists","fileLocation","existsFile","exists","delete","deleteFilesOfFolderFromGoogleStorage","userFolder","deleteFiles","prefix"],"mappings":"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","sourcesContent":["import mimetypes from 'mimetypes';\nimport Utilities from \"./Utilities\";\nimport { BASE_URL_STORAGE , firebaseAdminsStorage} from \"../services/FirebaseAdmin\";\nimport {ResponseMessage} from \"./ResponseMesssage\";\n\nexport default {\n    async saveFileFromBufferToGoogleStorage(fileBuffer, name, path ,mimeType) {\n        const responseMessage = new ResponseMessage();\n        const versionFile= Utilities.generateNumberToken(10,99);\n        const filename = `${ name }${ versionFile }.${ mimetypes.detectExtension(mimeType) }`;\n        const file = firebaseAdminsStorage.file(`${ path}/${ filename}`);\n        const fileUrl = `${ BASE_URL_STORAGE }/${ firebaseAdminsStorage.name }/${ path }/${ filename }`;\n        try{\n                await file.save(fileBuffer,{\n                    metadata: {\n                        contentType: mimeType\n                    },\n                    public: true\n                });\n                responseMessage.create('File uploaded',null,{success: true, fileUrl});\n\n        }catch(exception){\n            console.error('Error uploading file to Google Storage: ', exception);\n            responseMessage.create('Error uploading file to Google Storage',null,{success: false});\n        }\n        return responseMessage;\n    },\n    async saveFileFromBase64ToGoogleStorage(base64file,name,path){\n        const mimeType = base64file.match(/data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+).*,.*/)[1];\n        const base64EncodedImageString= base64file.split(';base64,').pop();\n        const fileBuffer= Buffer.from(base64EncodedImageString,'base64');\n        return await this.saveFileFromBufferToGoogleStorage(fileBuffer,name,path,mimeType);\n    },\n    async deleteFileFromGoogleStoreIfExists(fileLocation){\n        const file = firebaseAdminsStorage.file(fileLocation);\n        try{\n            const existsFile = await file.exists();\n            if(existsFile[0]){\n                    await file.delete();\n            }\n        }catch(exception){\n            console.error('Ha habido un error al borrar archivo de Google Store', exception);\n        }\n\n    },\n    async deleteFilesOfFolderFromGoogleStorage(userFolder) {\n        try {\n            await firebaseAdminsStorage.deleteFiles({prefix: userFolder + '/'});\n        } catch (exception) {\n            console.error('Error deleting files from Google Storage');\n        }\n    }\n}\n"]},"sourceType":"module","hash":"677cf62f0599e01792cb186f9d93f8e59b70fa7e"}
