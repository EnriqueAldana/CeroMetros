{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/api/Workstations/WorkStationCtl.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/api/Workstations/WorkStationCtl.js","filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/api/Workstations/WorkStationCtl.js","cloneInputAst":true,"passPerPreset":false,"envName":"development","cwd":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","root":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.12.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/enrique/DiscoDeEnrique/2021/Proyectos/CeroMetros/imports/api/Workstations/WorkStationCtl.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/Workstations/WorkStationCtl.js"}},"code":"let check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 0);\nlet ValidatedMethod;\nmodule.link(\"meteor/mdg:validated-method\", {\n  ValidatedMethod(v) {\n    ValidatedMethod = v;\n  }\n\n}, 1);\nlet ResponseMessage;\nmodule.link(\"../../startup/server/utilities/ResponseMesssage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 2);\nlet AuthGuard;\nmodule.link(\"../../middlewares/AuthGuard\", {\n  default(v) {\n    AuthGuard = v;\n  }\n\n}, 3);\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 4);\nlet WorkstationRepository;\nmodule.link(\"./WorkStation\", {\n  WorkstationRepository(v) {\n    WorkstationRepository = v;\n  }\n\n}, 5);\nlet WorkStationServ;\nmodule.link(\"./WorkStationServ\", {\n  default(v) {\n    WorkStationServ = v;\n  }\n\n}, 6);\nnew ValidatedMethod({\n  name: 'workstation.save',\n  mixins: [MethodHooks],\n  permissions: [Permissions.WORKSTATIONS.CREATE.VALUE, Permissions.WORKSTATIONS.UPDATE.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(workstation) {\n    try {\n      console.info('workstation ', workstation);\n      check(workstation, {\n        _id: Match.OneOf(String, null),\n        name: String,\n        name_full: String,\n        location: String,\n        productionline: {\n          _id: Match.OneOf(String, null),\n          name: Match.OneOf(String, null),\n          description: Match.OneOf(String, null)\n        }\n      });\n    } catch (exception) {\n      console.error('workstation.save', exception);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    } // Validar que no haya estaciones de trabajo con el mismo nombre   \n\n\n    WorkStationServ.validateWorkstationName(workstation.name, workstation._id);\n  },\n\n  run(workstation) {\n    const responseMessage = new ResponseMessage();\n\n    try {\n      if (workstation._id !== null) {\n        WorkStationServ.validateWorkstationChangeProductionLine(workstation);\n        WorkstationRepository.update(workstation._id, {\n          $set: {\n            name: workstation.name,\n            name_full: workstation.name_full,\n            location: workstation.location,\n            productionline: workstation.productionline\n          }\n        });\n        responseMessage.create('Se actualiz贸 la estacion de trabajo exitosamente');\n      } else {\n        WorkstationRepository.insert({\n          name: workstation.name,\n          name_full: workstation.name_full,\n          location: workstation.location,\n          productionline: workstation.productionline\n        }); // ToDo actualizar la Linea de produccion\n\n        responseMessage.create('Se insert贸 la estacion de trabajo exitosamente');\n      }\n    } catch (exception) {\n      console.error('workstation.save', exception);\n      throw new Meteor.Error('500', 'Ha ocurrido un error al guardar la estacion de trabajo');\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'workstation.delete',\n  mixins: [MethodHooks],\n  permissions: [Permissions.WORKSTATIONS.DELETE.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n  // Aqui se verifica si los permisos de usuario son adecuados para esta accion\n  afterHooks: [],\n\n  validate(_ref) {\n    let {\n      idWorkstation\n    } = _ref;\n\n    try {\n      check(idWorkstation, String);\n    } catch (exception) {\n      console.error('workstation.delete', exception);\n      throw new Meteor.Error('403', 'Ocurrio un error al eliminar la estacion de trabajo');\n    } // validar que no sea posible eliminar una estacion si hay una linea utilizandolo.\n\n\n    const workstationWithProductionLine = WorkStationServ.validateWorkstationBusy(idWorkstation);\n\n    if (workstationWithProductionLine > 0) {\n      throw new Meteor.Error('403', 'No es posible elimiar la estacion de trabajo', 'Hay al menos una linea de produccion utilizandola');\n    }\n  },\n\n  run(_ref2) {\n    let {\n      idWorkstation\n    } = _ref2;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      WorkstationRepository.remove(idWorkstation);\n      responseMessage.create('Estacion de trabajo eliminada exitosamente');\n    } catch (exception) {\n      console.error('workstation.delete', exception);\n      throw new Meteor.Error('500', 'Ocurrio un error al eliminar la estacion de trabajo');\n    }\n\n    return responseMessage;\n  }\n\n});","map":{"version":3,"sources":["imports/api/Workstations/WorkStationCtl.js"],"names":["check","Match","module","link","v","ValidatedMethod","ResponseMessage","AuthGuard","default","Permissions","WorkstationRepository","WorkStationServ","name","mixins","MethodHooks","permissions","WORKSTATIONS","CREATE","VALUE","UPDATE","beforeHooks","checkPermission","validate","workstation","console","info","_id","OneOf","String","name_full","location","productionline","description","exception","error","Meteor","Error","validateWorkstationName","run","responseMessage","validateWorkstationChangeProductionLine","update","$set","create","insert","DELETE","afterHooks","idWorkstation","workstationWithProductionLine","validateWorkstationBusy","remove"],"mappings":"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","sourcesContent":["import {check, Match} from \"meteor/check\";\nimport {ValidatedMethod} from 'meteor/mdg:validated-method';\nimport {ResponseMessage} from \"../../startup/server/utilities/ResponseMesssage\";\nimport AuthGuard from \"../../middlewares/AuthGuard\";\nimport Permissions from \"../../startup/server/Permissions\";\nimport {WorkstationRepository} from './WorkStation'\nimport WorkStationServ from \"./WorkStationServ\";\n\nnew ValidatedMethod({\n    name:'workstation.save',\n     mixins:[MethodHooks],\n     permissions: [Permissions.WORKSTATIONS.CREATE.VALUE,Permissions.WORKSTATIONS.UPDATE.VALUE],  \n     beforeHooks: [AuthGuard.checkPermission],\n    validate(workstation){\n        try {\n            console.info('workstation ' , workstation);\n            check(workstation,{\n                _id: Match.OneOf(String, null),\n                name: String,\n                name_full: String,\n                location: String,\n                productionline: {\n                    _id:Match.OneOf(String, null),\n                    name: Match.OneOf(String, null),\n                    description:Match.OneOf(String, null)\n                }\n            });\n\n        }catch ( exception){\n            console.error('workstation.save', exception);\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\n        }\n        // Validar que no haya estaciones de trabajo con el mismo nombre   \n        \n        WorkStationServ.validateWorkstationName(workstation.name,workstation._id);\n    },\n    run(workstation){\n        const responseMessage = new ResponseMessage(); \n        try {\n            if(workstation._id !== null){\n                WorkStationServ.validateWorkstationChangeProductionLine(workstation);\n                WorkstationRepository.update(workstation._id,{\n                    $set: {\n                    name: workstation.name,\n                    name_full: workstation.name_full,\n                    location: workstation.location,\n                    productionline: workstation.productionline\n                    }\n                });\n                \n\n                responseMessage.create('Se actualiz贸 la estacion de trabajo exitosamente');\n            }else{\n                WorkstationRepository.insert({\n                    name: workstation.name,\n                    name_full: workstation.name_full,\n                    location: workstation.location,\n                    productionline: workstation.productionline\n                });\n\n                // ToDo actualizar la Linea de produccion\n\n                responseMessage.create('Se insert贸 la estacion de trabajo exitosamente');\n            }\n        }catch ( exception){\n            console.error('workstation.save', exception);\n            throw new Meteor.Error('500', 'Ha ocurrido un error al guardar la estacion de trabajo');\n        }\n        return responseMessage;\n    }\n });\n\nnew ValidatedMethod({\n    name: 'workstation.delete',\n    mixins: [MethodHooks],\n    permissions: [Permissions.WORKSTATIONS.DELETE.VALUE],\n    beforeHooks: [AuthGuard.checkPermission],  // Aqui se verifica si los permisos de usuario son adecuados para esta accion\n    afterHooks: [],\n    validate({ idWorkstation }){\n        try {\n            check(idWorkstation , String);\n        }catch (exception) {\n            console.error('workstation.delete', exception);\n            throw new Meteor.Error('403', 'Ocurrio un error al eliminar la estacion de trabajo');\n        }\n        // validar que no sea posible eliminar una estacion si hay una linea utilizandolo.\n        const workstationWithProductionLine = WorkStationServ.validateWorkstationBusy(idWorkstation);\n        if (workstationWithProductionLine > 0){\n            throw new Meteor.Error('403','No es posible elimiar la estacion de trabajo',\n                'Hay al menos una linea de produccion utilizandola');\n        }\n    },\n    run({ idWorkstation }){\n        const responseMessage = new ResponseMessage();\n        try {\n            WorkstationRepository.remove(idWorkstation);\n                responseMessage.create('Estacion de trabajo eliminada exitosamente');\n        }catch (exception) {\n            console.error('workstation.delete', exception);\n            throw new Meteor.Error('500', 'Ocurrio un error al eliminar la estacion de trabajo');\n        }\n\n        return responseMessage;\n    }\n});\n"]},"sourceType":"module","hash":"20eb13f76001605931145cf3d73e76c4974a9649"}
